# BruteForceCalling

## プロジェクトの概要

今すぐ連絡したい!!
でも電話してもなかなか繋がらない!!
そんなことにお困りの方にBruteFroceCallingに電話をかけてアナウンスにしたがって、かけたい相手の番号を登録しておくと、たとえ相手が電話に出なかったとしても、相手が電話に出てくれるまで繰り返し電話をかけ続けてくれるサービスですます。
[BruteForceCalling](https://protopedia.net/prototype/801272ee79cfde7fa5960571fee36b9b)

## 技術的なお話

### Twilio

#### 電話がかかってくる

コンソールから電話がかかってきた時に飛ばされるリクエストのURLを設定する。実際に電話がかかってくるとここで設定したURLにリクエストが飛ばされる。リクエストにはrequest bodyにJSONでデータが含まれて送られてくる。(以降のWebhook全てに共通する)このリクエストでTwiMLというXMLで返すことで、電話を受け取った後の挙動を制御できる。

#### 番号を入力してもらう

TwiMLでGatherという項目を入力することで、番号の入力を受け付ける。
入力された番号の終了ボタンは基本的には#になっている。(ただし変更することも可能)
またGatherは基本的に別のエンドポイントにredirectする。

#### 電話を転送する

上記、電話がかかってきている中でTwiMLでDialという項目で入力することで、受けている電話を転送することができる。

#### 電話中なのか判別する

電話の呼び出し中、電話を切られましたなど、状態が変更するとStatusが呼ばれる。電話が受け取られたのかどうかはここに送られてくる情報をもとに判断する。また、このリクエストのURLもコンソールから設定できる。

#### 電話をかける


### firebase

#### 環境変数の設定

`dotenv` 

このように入力されているのが確認できます。
なお、大文字のkeyを登録することはできません。

#### firestore



【参考】
 * [環境の構成](https://firebase.google.com/docs/functions/config-env)